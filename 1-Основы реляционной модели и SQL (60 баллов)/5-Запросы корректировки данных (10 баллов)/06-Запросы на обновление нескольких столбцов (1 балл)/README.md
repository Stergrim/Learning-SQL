# Запросы на обновление нескольких столбцов

Запросом `UPDATE` можно обновлять значения нескольких столбцов одновременно. В этом случае простейший запрос будет выглядеть так:

```mysql
UPDATE таблица SET поле1 = выражение1, поле2 = выражение2
```

На складе, кроме хранения и получения книг, выполняется их оптовая продажа. Для реализации этого действия включим дополнительный столбец `buy` в таблицу `book`:

| **book_id**                         | **title**        | **author**          | **price**    | **amount** | **buy** |
|:------------------------------------|:-----------------|:--------------------|:-------------|:-----------|:--------|
| INT PRIMARY KEY AUTO_INCREMENT      | VARCHAR(50)      | VARCHAR(30)         | DECIMAL(8,2) | INT        | INT     |
| 1                              | Мастер и Маргарита    | Булгаков М.А.       | 670.99       | 3          | 0       |
| 2                              | Белая гвардия         | Булгаков М.А.       | 540.50       | 5          | 3       |
| 3                              | Идиот                 | Достоевский Ф.М.    | 460.00       | 10         | 8       |
| 4                              | Братья Карамазовы     | Достоевский Ф.М.    | 799.01       | 2          | 0       |
| 5                              | Стихотворения и поэмы | Есенин С.А.         | 650.00       | 15         | 18      |

**Пример**

В столбце `buy` покупатель указывает количество книг, которые он хочет приобрести. Для каждой книги, выбранной покупателем, необходимо уменьшить ее количество на складе на указанное в столбце `buy` количество, а в столбец `buy` занести 0.

*Запрос:*

```mysql
UPDATE book 
SET amount = amount - buy,
    buy = 0;

SELECT * FROM book;
```

*Результат:*

```mysql
Query result:
+---------+-----------------------+------------------+--------+--------+-----+
| book_id | title                 | author           | price  | amount | buy |
+---------+-----------------------+------------------+--------+--------+-----+
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      | 0   |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 2      | 0   |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 2      | 0   |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      | 0   |
| 5       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | -3     | 0   |
+---------+-----------------------+------------------+--------+--------+-----+
```

Как видно из таблицы, без проверки данных, которые занесены в столбец,  нельзя запускать запрос на обновление (может получиться отрицательное значение количества)

**Задание**

В таблице `book` необходимо скорректировать значение для покупателя в столбце `buy` таким образом, чтобы оно не превышало количество экземпляров книг, указанных в столбце `amount`. А цену тех книг, которые покупатель не заказывал, снизить на 10%.

Введите SQL запрос

*Результат:*

```mysql
Affected rows: 3
```

```mysql
UPDATE book
SET buy = IF(buy - amount > 0, amount, buy),
    price = IF(buy = 0, 0.9*price, price);
```

Вы получили: 1 балл из 1
