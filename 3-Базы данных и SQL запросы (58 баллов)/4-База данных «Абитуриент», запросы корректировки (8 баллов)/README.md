# База данных «Абитуриент», запросы корректировки

В данном уроке с помощью запросов корректировки данных для базы данных «Абитуриент» формируется список абитуриентов, рекомендованных к зачислению в университет:
- создается таблица с суммой баллов абитуриентов по предметам ЕГЭ в соответствии с поданными заявлениями;
- из таблицы удаляются абитуриенты, если они не набрали минимального балла по предмету, необходимому для поступления на образовательную программу;
- абитуриентам, у которых есть медаль или значок ГТО, добавляются дополнительные баллы;
- абитуриенты сортируются в соответствии с набранными баллами по каждой образовательной программе;
- формируется список абитуриентов, рекомендованных к зачислению ( вставляется столбец для нумерации, осуществляется нумерация студентов по образовательной программе, выбираются абитуриенты с наибольшими баллами в соответствии с планом набора).

***Структура таблиц и их наполнение как на первом шаге предыдущего урока.***

**Концептуальная схема базы данных**

<p float="left">
<img src="cx_3_1.jpg" width="400" />
</p>

**Логическая схема базы данных**

<p float="left">
<img src="11.jpg" width="800" />
</p>

**Структура и наполнение таблиц**

Таблица `department`:

| **department_id**                | **name_department**     |
|:---------------------------------|:------------------------|
| `INT PRIMARY KEY AUTO_INCREMENT` | `VARCHAR(30)`           |
| 1                                | Инженерная школа        |
| 2                                | Школа естественных наук |

Таблица `subject`:

| **subject_id**                   | **name_subject** |
|:---------------------------------|:-----------------|
| `INT PRIMARY KEY AUTO_INCREMENT` | `VARCHAR(30)`    |
| 1                                | Русский язык     |
| 2                                | Математика       |
| 3                                | Физика           |
| 4                                | Информатика      |

Таблица `program` (в последнем столбце указан план набора абитуриентов на образовательную программу):

| **program_id**                   | **name_program**                    | **department_id** | **plan** |  
|:---------------------------------|:------------------------------------|:------------------|:---------|  
| `INT PRIMARY KEY AUTO_INCREMENT` | `VARCHAR(50)`                       | `INT`             | `INT`    |  
| 1                                | Прикладная математика и информатика | 2                 | 2        |  
| 2                                | Математика и компьютерные науки     | 2                 | 1        |  
| 3                                | Прикладная механика                 | 1                 | 2        |  
| 4                                | Мехатроника и робототехника         | 1                 | 3        |  

Таблица `enrollee`:

| **enrollee_id**                  | **name_enrollee** |
|:---------------------------------|:------------------|
| `INT PRIMARY KEY AUTO_INCREMENT` | `VARCHAR(50)`     |
| 1                                | Баранов Павел     |
| 2                                | Абрамова Катя     |
| 3                                | Семенов Иван      |
| 4                                | Яковлева Галина   |
| 5                                | Попов Илья        |
| 6                                | Степанова Дарья   |

Таблица `achievement` (таблица включает все достижения, которые учитываются при поступлении в университет, в последнем столбце указывается количество баллов, которое добавляется к сумме баллов по предметам ЕГЭ при расчете общего балла абитуриента):

| **achievement_id**               | **name_achievement**  | **bonus** | 
|:---------------------------------|:----------------------|:----------|  
| `INT PRIMARY KEY AUTO_INCREMENT` | `VARCHAR(30)`         | `INT`     |  
| 1                                | Золотая медаль        | 5         |
| 2                                | Серебряная медаль     | 3         |
| 3                                | Золотой значок ГТО    | 3         |
| 4                                | Серебряный значок ГТО | 1         |

Таблица `enrollee_achievement` (в таблице содержится информация о том, какие достижения имеют абитуриенты):

| **enrollee_achiev_id**           | **enrollee_id** | **achievement_id** | 
|:---------------------------------|:----------------|:-------------------|  
| `INT PRIMARY KEY AUTO_INCREMENT` | `INT`           | `INT`              |  
| 1                                | 1               | 2                  |
| 2                                | 1               | 3                  |
| 3                                | 3               | 1                  |
| 4                                | 4               | 4                  |
| 5                                | 5               | 1                  |
| 6                                | 5               | 3                  |

Таблица `program_subject` (в таблице указано, какие предметы ЕГЭ необходимы для поступления на каждую программу, в последнем столбце – минимальный балл по каждому предмету для образовательной программы):

| **program_subject_id**           | **program_id** | **subject_id** | **min_result** | 
|:---------------------------------|:---------------|:---------------|:---------------|  
| `INT PRIMARY KEY AUTO_INCREMENT` | `INT`          | `INT`          | `INT`          |  
| 1                                | 1              | 1              | 40             |
| 2                                | 1              | 2              | 50             |
| 3                                | 1              | 4              | 60             |
| 4                                | 2              | 1              | 30             |
| 5                                | 2              | 2              | 50             |
| 6                                | 2              | 4              | 60             |
| 7                                | 3              | 1              | 30             |
| 8                                | 3              | 2              | 45             |
| 9                                | 3              | 3              | 45             |
| 10                               | 4              | 1              | 40             |
| 11                               | 4              | 2              | 45             |
| 12                               | 4              | 3              | 45             |

Таблица `program_enrollee` (таблица включает информацию, на какую образовательную программу хочет поступить абитуриент):

| **program_enrollee_id**          | **program_id** | **enrollee_id** | 
|:---------------------------------|:---------------|:----------------|  
| `INT PRIMARY KEY AUTO_INCREMENT` | `INT`          | `INT`           |  
| 1                                | 3              | 1               |
| 2                                | 4              | 1               |
| 3                                | 1              | 1               |
| 4                                | 2              | 2               |
| 5                                | 1              | 2               |
| 6                                | 1              | 3               |
| 7                                | 2              | 3               |
| 8                                | 4              | 3               |
| 9                                | 3              | 4               |
| 10                               | 3              | 5               |
| 11                               | 4              | 5               |
| 12                               | 2              | 6               |
| 13                               | 3              | 6               |
| 14                               | 4              | 6               |

Таблица `enrollee_subject` (баллы ЕГЭ каждого абитуриента):

| **enrollee_subject_id** | **enrollee_id** | **subject_id** | **result** | 
|:------------------------|:----------------|:---------------|:-----------|  
| `I`                     | `INT`           | `INT`          | `INT`      |  
| 1                       | 1               | 1              | 68         |
| 2                       | 1               | 2              | 70         |
| 3                       | 1               | 3              | 41         |
| 4                       | 1               | 4              | 75         |
| 5                       | 2               | 1              | 75         |
| 6                       | 2               | 2              | 70         |
| 7                       | 2               | 4              | 81         |
| 8                       | 3               | 1              | 85         |
| 9                       | 3               | 2              | 67         |
| 10                      | 3               | 3              | 90         |
| 11                      | 3               | 4              | 78         |
| 12                      | 4               | 1              | 82         |
| 13                      | 4               | 2              | 86         |
| 14                      | 4               | 3              | 70         |
| 15                      | 5               | 1              | 65         |
| 16                      | 5               | 2              | 67         |
| 17                      | 5               | 3              | 60         |
| 18                      | 6               | 1              | 90         |
| 19                      | 6               | 2              | 92         |
| 20                      | 6               | 3              | 88         |
| 21                      | 6               | 4              | 94         |

**Пояснение.** Для всех внешних ключей в базе данных установлено `ON DELETE CASCADE`.
